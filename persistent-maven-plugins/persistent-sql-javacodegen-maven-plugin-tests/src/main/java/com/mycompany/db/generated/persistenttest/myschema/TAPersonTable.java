package com.mycompany.db.generated.persistenttest.myschema;

import com.persistentbit.collections.PList;
import com.persistentbit.sql.dsl.exprcontext.DbContext;
import com.persistentbit.sql.dsl.exprcontext.DbTableContext;
import com.persistentbit.sql.dsl.generic.expressions.DExprTable;
import com.persistentbit.sql.dsl.generic.inserts.Insert;
import com.persistentbit.sql.dsl.generic.query.Query;
import com.persistentbit.sql.dsl.generic.updates.Update;
import com.persistentbit.sql.work.DbWork;

public class TAPersonTable extends TAPerson implements DExprTable<APerson> {
	
	
	public TAPersonTable(DbTableContext tableContext){
		super(tableContext.createExprLong("id"),tableContext.createExprString("user_name"),tableContext.createExprString("password"),tableContext.createExprString("street"),tableContext.createExprInt( "house_number"),tableContext.createExprString("bus_number"),tableContext.createExprString("postalcode"),tableContext.createExprString("city"),tableContext.createExprString("country"));
		this._tableContext = tableContext;
		this._insertFieldNames = PList.val("id", "user_name", "password", "street", "house_number", "bus_number", "postalcode", "city", "country");
		this._autoGenKeyFieldNames = PList.val("id");
	}
	public  TAPersonTable	alias(String tableAlias){
		return new TAPersonTable(_tableContext.withTableAlias(tableAlias));
	}
	@Override
	public  Query	query(){
		return _tableContext.createQuery(this);
	}
	@Override
	public  TAPerson	all(){
		return this;
	}
	public  TAPerson	val(APerson v){
		DbContext db = _tableContext.getDbContext();
		return new TAPerson(
			db.val(v.getId()), db.val(v.getUserName()), db.val(v.getPassword()), db.val(v.getStreet()), db.val(v.getHouseNumber()), db.val(v.getBusNumber().orElse(null)), db.val(v.getPostalcode()), db.val(v.getCity()), db.val(v.getCountry())
		);
	}
	public  Update	update(){
		return new Update(_tableContext.getDbContext(),this);
	}
	public  DbWork<Integer>	update(APerson record){
		DbContext db = _tableContext.getDbContext();
		return update()
			.set(this.userName, db.val(record.getUserName()))
			.set(this.password, db.val(record.getPassword()))
			.set(this.street, db.val(record.getStreet()))
			.set(this.houseNumber, db.val(record.getHouseNumber()))
			.set(this.busNumber, db.val(record.getBusNumber().orElse(null)))
			.set(this.postalcode, db.val(record.getPostalcode()))
			.set(this.city, db.val(record.getCity()))
			.set(this.country, db.val(record.getCountry()))
			.where(this.id.eq(db.val(record.getId())));
	}
	public  DbWork<APerson>	insert(APerson record){
		return new Insert(_tableContext.getDbContext(),this)
			.row(val(record))
			.withAutoGenerated(id)
			.map(insertResult -> {
				PList keys = insertResult.getAutoGenKeys().head();
				return record
					.withId((long)keys.get(0))
				;
			});
	}
}
